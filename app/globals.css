@tailwind base;
@tailwind components;
@tailwind utilities;

html, body, #__next { height: 100%; }
body { @apply bg-white text-gray-900; }

/* iPhone 15 等现代手机适配 - 安全区域支持 */
:root {
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-inset-left: env(safe-area-inset-left, 0px);
  --safe-area-inset-right: env(safe-area-inset-right, 0px);
}

/* 让 FlipBook 外层容器保持：高优先，宽度按 A4 竖版比例推算（≈ 0.707） */
.book-portrait {
  /* 手机/小屏：考虑安全区域，使用动态视口高度 */
  height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
  width: min(calc((100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707), calc(100vw - var(--safe-area-inset-left) - var(--safe-area-inset-right) - 32px));
  margin-inline: auto; /* 水平居中 */
  padding-top: var(--safe-area-inset-top);
  padding-bottom: var(--safe-area-inset-bottom);
  padding-left: var(--safe-area-inset-left);
  padding-right: var(--safe-area-inset-right);
}

/* iPhone 15 系列特定适配 */
@media (max-width: 430px) {
  .book-portrait {
    /* iPhone 15 Plus/Pro Max (430px) */
    height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
    width: min(calc((100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707), calc(100vw - 24px));
    padding-left: 12px;
    padding-right: 12px;
  }
}

@media (max-width: 393px) {
  .book-portrait {
    /* iPhone 15/Pro (393px) */
    height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
    width: min(calc((100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707), calc(100vw - 20px));
    padding-left: 10px;
    padding-right: 10px;
  }
}

/* 中等屏以上，略微留点边距更沉浸 */
@media (min-width: 768px) {
  .book-portrait {
    height: 88vh;
    width: min(calc(88vh * 0.707), 1000px);
    padding: 0; /* 桌面端不需要安全区域 */
  }
}

/* 超大屏：更大一些 */
@media (min-width: 1280px) {
  .book-portrait {
    height: 92vh;
    width: min(calc(92vh * 0.707), 1100px);
    padding: 0; /* 桌面端不需要安全区域 */
  }
}

@keyframes wiggle {
  0%, 100% { transform: rotate(0deg); }
  50% { transform: rotate(-5deg); }
}
.animate-wiggle {
  animation: wiggle 1s infinite ease-in-out;
}


@keyframes spineBreath {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(1.5px); }
}
.spine-breath { animation: spineBreath 2.4s ease-in-out infinite; }

/* Demo页面移动端优化样式 */
.mobile-optimized .book-portrait {
  /* 移动端专用样式 - 全屏显示 */
  height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
  width: min(calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707, calc(100vw - var(--safe-area-inset-left) - var(--safe-area-inset-right)));
  max-height: 100dvh;
  max-width: 100vw;
}

/* 移动端和iPad图片优化 */
@media (max-width: 1024px) {
  .mobile-optimized .book-portrait {
    /* 移动端全屏优化 */
    height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
    width: min(calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707, calc(100vw - 16px));
    margin: 0 auto;
  }
  
  .mobile-optimized .book-portrait img {
    max-width: 100%;
    height: auto;
    object-fit: contain;
    object-position: center;
  }
  
  .mobile-optimized .book-portrait article {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .mobile-optimized .book-portrait .h-full.w-full.bg-white {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* iPhone 15 系列特殊优化 */
  @media (max-width: 430px) {
    .mobile-optimized .book-portrait {
      width: min(calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707, calc(100vw - 12px));
    }
  }
  
  @media (max-width: 393px) {
    .mobile-optimized .book-portrait {
      width: min(calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom)) * 0.707, calc(100vw - 8px));
    }
  }
}

/* 安全区域填充 */
.safe-area-padding {
  padding-top: var(--safe-area-inset-top);
  padding-left: var(--safe-area-inset-left);
  padding-right: var(--safe-area-inset-right);
}

/* 强制覆盖book-portrait的CSS规则，确保JavaScript计算的尺寸生效 */
.single-page-flipbook {
  /* 覆盖所有book-portrait的媒体查询规则 */
  width: var(--js-calculated-width, 100%) !important;
  height: var(--js-calculated-height, 100vh) !important;
  max-width: var(--js-calculated-width, 100vw) !important;
  max-height: var(--js-calculated-height, 100vh) !important;
  margin: 0 auto !important;
  /* 确保容器不会被其他CSS规则限制 */
  min-width: 0 !important;
  min-height: 0 !important;
}

/* 桌面端强制覆盖 */
@media (min-width: 768px) {
  .single-page-flipbook {
    width: var(--js-calculated-width, 100%) !important;
    height: var(--js-calculated-height, 100vh) !important;
    max-width: var(--js-calculated-width, 100vw) !important;
    max-height: var(--js-calculated-height, 100vh) !important;
  }
}

/* 桌面端优化类 - 移除所有尺寸限制 */
.desktop-optimized {
  /* 移除所有Tailwind尺寸类的影响 */
  width: auto !important;
  height: auto !important;
  max-width: none !important;
  max-height: none !important;
}

.desktop-optimized .book-portrait {
  /* 移除book-portrait的所有尺寸限制 */
  width: auto !important;
  height: auto !important;
  max-width: none !important;
  max-height: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* 单页显示容器 - 简化版本 */
.book-portrait {
  /* 手机/小屏：铺满可视高度 */
  height: 100svh;
  width: min(calc(100svh * 0.707), 900px);
  margin-inline: auto;
  position: relative;
}

/* 中等屏以上 */
@media (min-width: 768px) {
  .book-portrait {
    height: 88vh;
    width: min(calc(88vh * 0.707), 1000px);
  }
}

/* 超大屏 */
@media (min-width: 1280px) {
  .book-portrait {
    height: 92vh;
    width: min(calc(92vh * 0.707), 1100px);
  }
}

/* 翻页动画效果 */
.page-flipping {
  perspective: 1000px;
}

/* 下一页翻出动画 */
.page-flip-out-next {
  transform-origin: left center;
  animation: flipOutNext 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

/* 上一页翻出动画 */
.page-flip-out-prev {
  transform-origin: right center;
  animation: flipOutPrev 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

/* 下一页翻入动画 */
.page-flip-in-next {
  transform-origin: right center;
  animation: flipInNext 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

/* 上一页翻入动画 */
.page-flip-in-prev {
  transform-origin: left center;
  animation: flipInPrev 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

/* 翻页动画关键帧 */
@keyframes flipOutNext {
  0% {
    transform: rotateY(0deg);
    opacity: 1;
  }
  50% {
    transform: rotateY(-90deg);
    opacity: 0.8;
  }
  100% {
    transform: rotateY(-180deg);
    opacity: 0;
  }
}

@keyframes flipOutPrev {
  0% {
    transform: rotateY(0deg);
    opacity: 1;
  }
  50% {
    transform: rotateY(90deg);
    opacity: 0.8;
  }
  100% {
    transform: rotateY(180deg);
    opacity: 0;
  }
}

@keyframes flipInNext {
  0% {
    transform: rotateY(180deg);
    opacity: 0;
  }
  50% {
    transform: rotateY(90deg);
    opacity: 0.8;
  }
  100% {
    transform: rotateY(0deg);
    opacity: 1;
  }
}

@keyframes flipInPrev {
  0% {
    transform: rotateY(-180deg);
    opacity: 0;
  }
  50% {
    transform: rotateY(-90deg);
    opacity: 0.8;
  }
  100% {
    transform: rotateY(0deg);
    opacity: 1;
  }
}

/* 翻页阴影效果 */
.page-flip-out-next::before,
.page-flip-out-prev::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0.1) 0%, transparent 50%);
  pointer-events: none;
  opacity: 0;
  animation: shadowFade 0.6s ease-in-out forwards;
}

.page-flip-out-prev::before {
  background: linear-gradient(270deg, rgba(0,0,0,0.1) 0%, transparent 50%);
}

@keyframes shadowFade {
  0% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}

/* 移动端工具栏优化 */
@media (max-width: 1024px) {
  .mobile-toolbar {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  /* 移动端缩略图优化 */
  .mobile-thumbs {
    max-height: 120px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }
  
  .mobile-thumbs::-webkit-scrollbar {
    height: 4px;
  }
  
  .mobile-thumbs::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 2px;
  }
  
  .mobile-thumbs::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 2px;
  }
  
  .mobile-thumbs::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }
  
  /* 移动端按钮优化 */
  .mobile-button {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* iPhone 15 系列特殊优化 */
  @media (max-width: 430px) {
    .mobile-optimized .book-portrait {
      height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom) - 70px);
      max-height: calc(100dvh - 70px);
    }
  }
  
  @media (max-width: 393px) {
    .mobile-optimized .book-portrait {
      height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom) - 65px);
      max-height: calc(100dvh - 65px);
    }
  }
}

/* 移动端触摸优化 */
@media (hover: none) and (pointer: coarse) {
  .hover\:scale-102:hover {
    transform: scale(1.02);
  }
  
  .hover\:bg-blue-200:hover {
    background-color: rgb(191 219 254);
  }
  
  .hover\:bg-green-200:hover {
    background-color: rgb(187 247 208);
  }
  
  /* 移动端翻书优化 */
  .mobile-optimized .book-portrait {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
  
  /* 移动端页面容器优化 */
  .mobile-optimized .book-portrait article {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* 强制单页模式 - 更强制的方法 */
  .mobile-optimized .book-portrait .st-page {
    width: 100% !important;
    height: 100% !important;
    position: relative !important;
  }
  
  /* 禁用双页模式 */
  .mobile-optimized .book-portrait .st-page-wrapper {
    display: block !important;
    width: 100% !important;
  }
  
  /* 强制单页布局 */
  .mobile-optimized .book-portrait .st-book {
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* iPad特殊处理 */
  @media (min-width: 768px) and (max-width: 1024px) {
    .mobile-optimized .book-portrait .st-page {
      width: 100% !important;
      max-width: 100% !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 100% !important;
      max-width: 100% !important;
    }
  }
  
  /* 强制单页模式的CSS类 */
  .force-single-page .st-page {
    width: 100% !important;
    max-width: 100% !important;
  }
  
  .force-single-page .st-page-wrapper {
    width: 100% !important;
    max-width: 100% !important;
    display: block !important;
  }
  
  /* iPad Pro 12.9" 特殊样式 (1024px+) */
  @media (min-width: 1024px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      width: 750px !important;
      max-width: 750px !important;
      height: 1000px !important;
      margin: 0 auto !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 750px !important;
      max-width: 750px !important;
      height: 1000px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 750px !important;
      max-width: 750px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-book {
      width: 750px !important;
      max-width: 750px !important;
    }
  }
  
  /* 1024×1366 分辨率特殊处理 - 优化空间利用 */
  @media (width: 1024px) and (height: 1366px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      width: 750px !important;
      max-width: 750px !important;
      height: 1200px !important;
      margin: 0 auto !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 750px !important;
      max-width: 750px !important;
      height: 1200px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 750px !important;
      max-width: 750px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-book {
      width: 750px !important;
      max-width: 750px !important;
    }
  }
  
  /* 强制所有iPad设备单页模式 - 优化空间利用 */
  @media (min-width: 768px) and (max-width: 1366px) and (min-height: 1024px) and (max-height: 2048px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      width: 750px !important;
      max-width: 750px !important;
      height: 1200px !important;
      margin: 0 auto !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 750px !important;
      max-width: 750px !important;
      height: 1200px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 750px !important;
      max-width: 750px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-book {
      width: 750px !important;
      max-width: 750px !important;
    }
  }
  
  /* 超强制单页模式 - 针对所有移动设备 - 优化空间利用 */
  @media (max-width: 1366px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      max-width: 75vw !important;
      width: 75vw !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 100% !important;
      max-width: 100% !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 100% !important;
      max-width: 100% !important;
    }
  }
  
  /* iPad Pro 11" 特殊样式 (820px-1023px) - 优化空间利用 */
  @media (min-width: 820px) and (max-width: 1023px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      width: 650px !important;
      max-width: 650px !important;
      height: 1000px !important;
      margin: 0 auto !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 650px !important;
      max-width: 650px !important;
      height: 1000px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 650px !important;
      max-width: 650px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-book {
      width: 650px !important;
      max-width: 650px !important;
    }
  }
  
  /* iPad Air/mini 特殊样式 (768px-819px) - 优化空间利用 */
  @media (min-width: 768px) and (max-width: 819px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      width: 600px !important;
      max-width: 600px !important;
      height: 900px !important;
      margin: 0 auto !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 600px !important;
      max-width: 600px !important;
      height: 900px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 600px !important;
      max-width: 600px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-book {
      width: 600px !important;
      max-width: 600px !important;
    }
  }
  
  /* 其他iPad尺寸统一样式 (550px-767px) */
  @media (min-width: 550px) and (max-width: 767px) and (pointer: coarse) {
    .mobile-optimized .book-portrait {
      width: 550px !important;
      max-width: 550px !important;
      height: 750px !important;
      margin: 0 auto !important;
    }
    
    .mobile-optimized .book-portrait .st-page {
      width: 550px !important;
      max-width: 550px !important;
      height: 750px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-page-wrapper {
      width: 550px !important;
      max-width: 550px !important;
      display: block !important;
    }
    
    .mobile-optimized .book-portrait .st-book {
      width: 550px !important;
      max-width: 550px !important;
    }
  }
}

/* 移动端和iPad全屏体验优化 */
@media (max-width: 1024px) {
  /* 移除页面滚动 */
  body {
    overflow: hidden;
  }
  
  /* 确保翻书组件占满屏幕 */
  .mobile-optimized {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
  }
  
  /* 移动端背景优化 */
  .mobile-optimized + * {
    background: transparent;
  }
}

/* SinglePageFlipBook 移动端优化样式 */
.single-page-flipbook {
  touch-action: pan-x; /* 只允许水平滑动 */
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
}

/* 移动端特定优化 */
@media (max-width: 768px) {
  .book-portrait {
    padding: max(env(safe-area-inset-top, 0), 8px) 
             max(env(safe-area-inset-right, 0), 8px) 
             max(env(safe-area-inset-bottom, 0), 8px) 
             max(env(safe-area-inset-left, 0), 8px);
  }
  
  .single-page-flipbook {
    width: 100% !important;
    height: 100% !important;
    max-width: calc(100vw - 16px);
    max-height: calc(100dvh - 16px);
  }
}

/* iPhone等小屏设备优化 */
@media (max-width: 430px) {
  .book-portrait {
    padding: max(env(safe-area-inset-top, 0), 4px) 
             max(env(safe-area-inset-right, 0), 4px) 
             max(env(safe-area-inset-bottom, 0), 4px) 
             max(env(safe-area-inset-left, 0), 4px);
  }
  
  .single-page-flipbook {
    max-width: calc(100vw - 8px);
    max-height: calc(100dvh - 8px);
  }
}

/* iPad等平板设备优化 */
@media (min-width: 768px) and (max-width: 1024px) {
  .single-page-flipbook {
    max-width: min(90vw, 700px);
    max-height: min(85vh, 900px);
  }
}

/* 横屏模式优化 */
@media (orientation: landscape) and (max-height: 500px) {
  .single-page-flipbook {
    max-height: calc(100vh - 20px);
  }
  
  .book-portrait {
    padding: 4px;
  }
}

