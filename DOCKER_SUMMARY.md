# ğŸ³ Docker æ„å»ºæ£€æŸ¥æ€»ç»“

## âœ… é…ç½®çŠ¶æ€

### æ ¸å¿ƒé…ç½®æ–‡ä»¶
- âœ… **Dockerfile** - å¤šé˜¶æ®µæ„å»ºï¼Œå·²ä¼˜åŒ–
- âœ… **docker-compose.yml** - å¼€å‘ç¯å¢ƒï¼Œç®€å•æ˜“ç”¨
- âœ… **docker-compose.prod.yml** - ç”Ÿäº§ç¯å¢ƒï¼Œå¸¦ Nginx + HTTPS
- âœ… **nginx/nginx.conf** - ä¸“ä¸šé…ç½®ï¼ŒåŒ…å«ç¼“å­˜å’Œå®‰å…¨
- âœ… **next.config.mjs** - standalone æ¨¡å¼å·²å¯ç”¨
- âœ… **.dockerignore** - åˆç†é…ç½®ï¼Œå‡å°‘æ„å»ºæ—¶é—´

### ä¾èµ–æ£€æŸ¥
- âœ… **package-lock.json** - å­˜åœ¨ï¼ˆ124KBï¼‰
- âœ… **Node ç‰ˆæœ¬** - 20 Alpineï¼ˆè½»é‡ä¸”æœ€æ–°ï¼‰
- âœ… **åŒ…ç®¡ç†å™¨** - npm

---

## ğŸ“Š é…ç½®è´¨é‡è¯„ä¼°

### Dockerfile â­â­â­â­â­ (5/5)
```
ä¼˜ç‚¹ï¼š
âœ… å¤šé˜¶æ®µæ„å»ºï¼ˆé™ä½æœ€ç»ˆé•œåƒå¤§å°ï¼‰
âœ… ä½¿ç”¨ Alpine Linuxï¼ˆä½“ç§¯å°ï¼‰
âœ… é root ç”¨æˆ·ï¼ˆå®‰å…¨ï¼‰
âœ… æ™ºèƒ½åŒ…ç®¡ç†æ”¯æŒï¼ˆpnpm/yarn/npmï¼‰
âœ… standalone æ¨¡å¼æ­£ç¡®é…ç½®

é¢„æœŸé•œåƒå¤§å°ï¼š~150-200 MB
æ„å»ºæ—¶é—´ï¼š~3-5 åˆ†é’Ÿ
```

### docker-compose.yml â­â­â­â­ (4/5)
```
ä¼˜ç‚¹ï¼š
âœ… ç®€å•æ˜“ç”¨
âœ… ç«¯å£æ˜ å°„æ¸…æ™°
âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®

å»ºè®®ï¼š
âš ï¸ å¯ä»¥æ·»åŠ  healthcheck
âš ï¸ å¯ä»¥æ·»åŠ  volume æŒ‚è½½
```

### docker-compose.prod.yml â­â­â­â­â­ (5/5)
```
ä¼˜ç‚¹ï¼š
âœ… ä¸¤æœåŠ¡æ¶æ„ï¼ˆapp + nginxï¼‰
âœ… å¥åº·æ£€æŸ¥æœºåˆ¶
âœ… è‡ªåŠ¨é‡å¯ç­–ç•¥
âœ… HTTPS æ”¯æŒ
âœ… æš´éœ²ç«¯å£é…ç½®æ­£ç¡®

æ³¨æ„ï¼š
âš ï¸ éœ€è¦ SSL è¯ä¹¦æ–‡ä»¶
```

### nginx/nginx.conf â­â­â­â­â­ (5/5)
```
ä¼˜ç‚¹ï¼š
âœ… HTTP â†’ HTTPS é‡å®šå‘
âœ… ç°ä»£ TLS é…ç½®ï¼ˆ1.2/1.3ï¼‰
âœ… gzip å‹ç¼©
âœ… é™æ€èµ„æºç¼“å­˜ç­–ç•¥ï¼š
   - /_next/static/ â†’ 30å¤©
   - /books/ â†’ 7å¤©
âœ… å®‰å…¨å¤´é…ç½®
âœ… WebSocket æ”¯æŒ
âœ… keepalive ä¼˜åŒ–

æ³¨æ„ï¼š
âš ï¸ åŸŸåç¡¬ç¼–ç ä¸º youthmba.com
âš ï¸ éœ€è¦è¯ä¹¦æ–‡ä»¶
```

---

## ğŸ” æ½œåœ¨é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: Docker å®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œ âš ï¸
**å½“å‰çŠ¶æ€ï¼š** `Cannot connect to the Docker daemon`

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# macOS
open -a Docker

# éªŒè¯
docker ps
```

### é—®é¢˜2: ç¼ºå°‘ SSL è¯ä¹¦ âš ï¸
**ç—‡çŠ¶ï¼š** Nginx æ— æ³•å¯åŠ¨ï¼ŒSSL é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆAï¼šä¸´æ—¶ç¦ç”¨ HTTPSï¼ˆå¼€å‘/æµ‹è¯•ï¼‰**
```bash
# ç¼–è¾‘ nginx/nginx.conf
# æ³¨é‡Šæ‰ç¬¬50è¡Œï¼ˆreturn 301 é‡å®šå‘ï¼‰
# æˆ–æ³¨é‡Šæ‰æ•´ä¸ª HTTPS server æ®µï¼ˆ54-123è¡Œï¼‰
```

**è§£å†³æ–¹æ¡ˆBï¼šä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼ˆæµ‹è¯•ï¼‰**
```bash
cd nginx/certs
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout privkey.pem -out fullchain.pem \
  -subj "/CN=youthmba.com"
```

**è§£å†³æ–¹æ¡ˆCï¼šä½¿ç”¨ Let's Encryptï¼ˆç”Ÿäº§ï¼‰**
```bash
# ä½¿ç”¨ certbot
certbot certonly --standalone -d youthmba.com
```

### é—®é¢˜3: åŸŸåç¡¬ç¼–ç  âš ï¸
**ä½ç½®ï¼š** nginx/nginx.conf ç¬¬47å’Œ57è¡Œ

**å½“å‰ï¼š**
```nginx
server_name youthmba.com;
```

**å»ºè®®æ”¹è¿›ï¼š** ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–æ¨¡æ¿

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### Step 1: éªŒè¯ Docker è¿è¡Œ
```bash
docker ps
# åº”è¯¥çœ‹åˆ°å®¹å™¨åˆ—è¡¨æˆ–ç©ºåˆ—è¡¨ï¼ˆæ— é”™è¯¯ï¼‰
```

### Step 2: ç®€å•æ„å»ºæµ‹è¯•
```bash
# æ„å»ºé•œåƒ
docker build -t my-flipbook-site:test .

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:3000 --name flipbook-test my-flipbook-site:test

# æ£€æŸ¥æ—¥å¿—
docker logs flipbook-test

# æµ‹è¯•è®¿é—®
curl http://localhost:3000

# æ¸…ç†
docker stop flipbook-test
docker rm flipbook-test
```

### Step 3: å¼€å‘ç¯å¢ƒæµ‹è¯•
```bash
# ä½¿ç”¨ docker-compose
docker compose up --build -d

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# æµ‹è¯•è®¿é—®
curl http://localhost:3000

# åœæ­¢
docker compose down
```

### Step 4: ç”Ÿäº§ç¯å¢ƒæµ‹è¯•
```bash
# å‡†å¤‡è¯ä¹¦ï¼ˆæˆ–è·³è¿‡ HTTPSï¼‰
# ç¼–è¾‘ nginx/nginx.conf ä»¥ç¦ç”¨ HTTPSï¼ˆè§è§£å†³æ–¹æ¡ˆAï¼‰

# æ„å»ºå¹¶å¯åŠ¨
docker compose -f docker-compose.prod.yml up --build -d

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.prod.yml logs -f

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:3000/_next/static

# åœæ­¢
docker compose -f docker-compose.prod.yml down
```

---

## ğŸ“‹ æµ‹è¯•æ¸…å•

### æ„å»ºé˜¶æ®µ
- [ ] Docker å®ˆæŠ¤è¿›ç¨‹è¿è¡Œæ­£å¸¸
- [ ] æ„å»ºæˆåŠŸæ— é”™è¯¯
- [ ] é•œåƒå¤§å°åˆç†ï¼ˆ< 250MBï¼‰
- [ ] æ„å»ºæ—¶é—´å¯æ¥å—ï¼ˆ< 10åˆ†é’Ÿï¼‰

### è¿è¡Œé˜¶æ®µ
- [ ] å®¹å™¨å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] æ—¥å¿—æ— é”™è¯¯
- [ ] åº”ç”¨å¯è®¿é—®

### åŠŸèƒ½æµ‹è¯•
- [ ] é¦–é¡µæ­£å¸¸åŠ è½½
- [ ] /books/demo ç¿»ä¹¦æ­£å¸¸
- [ ] é™æ€èµ„æºæ­£ç¡®åŠ è½½
- [ ] å›¾ç‰‡æ–‡ä»¶å¯è®¿é—®

### ç”Ÿäº§ç¯å¢ƒï¼ˆå¦‚æœæµ‹è¯•ï¼‰
- [ ] Nginx æœåŠ¡æ­£å¸¸
- [ ] åå‘ä»£ç†å·¥ä½œ
- [ ] HTTPS æ­£å¸¸ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- [ ] HTTP â†’ HTTPS é‡å®šå‘ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- [ ] ç¼“å­˜ç­–ç•¥ç”Ÿæ•ˆ
- [ ] å®‰å…¨å¤´æ­£ç¡®

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### æ¨èæ–¹æ¡ˆ1ï¼šç®€å•éƒ¨ç½²ï¼ˆå•å®¹å™¨ï¼‰
**é€‚ç”¨ï¼š** å¼€å‘ã€æµ‹è¯•ã€å°è§„æ¨¡éƒ¨ç½²

```bash
docker build -t my-flipbook-site .
docker run -d -p 3000:3000 --restart unless-stopped my-flipbook-site
```

**ä¼˜ç‚¹ï¼š**
- âœ… ç®€å•å¿«é€Ÿ
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… èµ„æºå ç”¨å°‘

**ç¼ºç‚¹ï¼š**
- âŒ æ—  HTTPS
- âŒ æ— è´Ÿè½½å‡è¡¡
- âŒ æ— é«˜çº§ç¼“å­˜

### æ¨èæ–¹æ¡ˆ2ï¼šç”Ÿäº§éƒ¨ç½²ï¼ˆNginx + HTTPSï¼‰
**é€‚ç”¨ï¼š** æ­£å¼ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. å‡†å¤‡è¯ä¹¦
cp /path/to/certs/* ./nginx/certs/

# 2. éƒ¨ç½²
docker compose -f docker-compose.prod.yml up -d

# 3. ç›‘æ§
docker compose -f docker-compose.prod.yml logs -f
```

**ä¼˜ç‚¹ï¼š**
- âœ… HTTPS æ”¯æŒ
- âœ… ä¸“ä¸šåå‘ä»£ç†
- âœ… ç¼“å­˜ä¼˜åŒ–
- âœ… å®‰å…¨åŠ å›º

**ç¼ºç‚¹ï¼š**
- âš ï¸ éœ€è¦è¯ä¹¦
- âš ï¸ é…ç½®è¾ƒå¤æ‚

### æ¨èæ–¹æ¡ˆ3ï¼šVercelï¼ˆäº‘å¹³å°ï¼‰â­
**é€‚ç”¨ï¼š** å¿«é€Ÿä¸Šçº¿ã€å…è´¹æ‰˜ç®¡

```bash
npm i -g vercel
vercel login
vercel --prod
```

**ä¼˜ç‚¹ï¼š**
- âœ… é›¶é…ç½®
- âœ… è‡ªåŠ¨ HTTPS
- âœ… CDN åŠ é€Ÿ
- âœ… è‡ªåŠ¨éƒ¨ç½²
- âœ… å…è´¹é¢åº¦

**ç¼ºç‚¹ï¼š**
- âš ï¸ ä¾èµ–ç¬¬ä¸‰æ–¹
- âš ï¸ æœ‰ä½¿ç”¨é™åˆ¶

---

## ğŸ“ é…ç½®æ–‡ä»¶å¯¹æ¯”

| é…ç½®é¡¹ | docker-compose.yml | docker-compose.prod.yml |
|--------|-------------------|------------------------|
| **ç”¨é€”** | å¼€å‘/æµ‹è¯• | ç”Ÿäº§ç¯å¢ƒ |
| **æœåŠ¡** | web (å•æœåŠ¡) | app + nginx (åŒæœåŠ¡) |
| **ç«¯å£** | 3000:3000 | 80/443 (nginx) |
| **HTTPS** | âŒ æ—  | âœ… æœ‰ |
| **å¥åº·æ£€æŸ¥** | âŒ æ—  | âœ… æœ‰ |
| **è‡ªåŠ¨é‡å¯** | âŒ æ—  | âœ… æœ‰ |
| **ç¼“å­˜** | âŒ æ—  | âœ… æœ‰ |
| **å¤æ‚åº¦** | ä½ | ä¸­ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš
1. [ ] å¯åŠ¨ Docker Desktopï¼ˆmacOSï¼‰
2. [ ] è¿è¡Œç®€å•æ„å»ºæµ‹è¯•
3. [ ] éªŒè¯å®¹å™¨è¿è¡Œ

### å‡†å¤‡ç”Ÿäº§
1. [ ] å‡†å¤‡ SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰
2. [ ] é…ç½®åŸŸå DNS
3. [ ] è°ƒæ•´ nginx é…ç½®
4. [ ] è®¾ç½®ç¯å¢ƒå˜é‡

### ä¼˜åŒ–é…ç½®
1. [ ] æ·»åŠ æ„å»ºç¼“å­˜
2. [ ] é…ç½® CI/CD
3. [ ] æ·»åŠ ç›‘æ§å‘Šè­¦
4. [ ] å¤‡ä»½ç­–ç•¥

---

## ğŸ“ ç›¸å…³é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé€‰æ‹© standalone æ¨¡å¼ï¼Ÿ
**A:** standalone æ¨¡å¼ç”Ÿæˆè‡ªåŒ…å«çš„æœåŠ¡å™¨ï¼ŒåŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œéå¸¸é€‚åˆ Docker éƒ¨ç½²ã€‚

### Q: é•œåƒå¤ªå¤§æ€ä¹ˆåŠï¼Ÿ
**A:** ç¡®ä¿ä½¿ç”¨ `.dockerignore`ï¼Œç¡®è®¤ä½¿ç”¨ Alpine åŸºç¡€é•œåƒï¼Œé¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹æ„å»ºæ—¥å¿—ï¼Ÿ
**A:** ä½¿ç”¨ `docker build --progress=plain` æˆ– `docker compose build --progress=plain`

### Q: å¦‚ä½•å¤„ç†åŸŸåå˜æ›´ï¼Ÿ
**A:** ä¿®æ”¹ `nginx/nginx.conf` ä¸­çš„ `server_name` å­—æ®µï¼Œé‡æ–°æ„å»ºã€‚

---

**åˆ›å»ºæ—¶é—´ï¼š** 2024-12-20
**çŠ¶æ€ï¼š** âœ… é…ç½®å®Œæ•´ï¼Œç­‰å¾… Docker è¿è¡Œåæµ‹è¯•
**ç›¸å…³æ–‡æ¡£ï¼š** `DOCKER_BUILD_ANALYSIS.md`, `flip_book_deploy.md`

